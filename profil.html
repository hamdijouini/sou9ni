<?php
session_start();

		$id = $_SESSION["id"];
		$nom = $_SESSION["nom"];
        $prenom = $_SESSION["prenom"];
		$email = $_SESSION["email"];
		$adresse = $_SESSION["adresse"];
        $tel = $_SESSION["tel"];
		$region = $_SESSION["region"];
		$login = $_SESSION["login"];
		$mdp = $_SESSION["mdp"];
?>

<!DOCTYPE html>

<html>
   <head>

      <title>Mon profil</title>

      <meta charset="utf-8">

      <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- Google Fonts -->
        <link href='css/google-font.css' rel='stylesheet' type='text/css'>

        <!-- Favicon -->
        <link rel="icon" type="image/png" href="images/favicon.png">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">

        <!-- Social icons CSS -->
        <link rel="stylesheet" type="text/css" href="css/social-icons.css">

        <!-- Menu CSS -->
        <link rel="stylesheet" type="text/css" href="css/menu.css">

        <!-- Footer CSS -->
        <link rel="stylesheet" type="text/css" href="css/footer.css">

        <!-- Responsive menu CSS -->
        <link rel="stylesheet" type="text/css" href="css/menu-responsive.css">

        <!-- Responsive footer CSS -->
        <link rel="stylesheet" type="text/css" href="css/footer-responsive.css">

       <!-- Style CSS -->
       <link rel="stylesheet" type="text/css" href="css/custom.css">

       <!-- Popup CSS -->
       <link rel="stylesheet" type="text/css" href="css/popup.css">

       <!-- Media query CSS -->
       <link rel="stylesheet" type="text/css" href="css/compte-responsive.css">

	    <!-- Profil CSS -->
        <link rel="stylesheet" type="text/css" href="css/profil.css">
	   
        <!-- Burger CSS -->
        <link rel="stylesheet" type="text/css" href="css/burger.css">

        <!-- Animate CSS -->
        <link rel="stylesheet" type="text/css" href="css/animate.css">

   </head>

  <body>
      <!-- Top Header -->
      <?php
        include("header-top.php");
      ?>

      <!-- Header -->
      <header class="header">

      </header>

   <!-- Profil section -->
   <section class="content">
      <div class="container">
        <div class="row">
          <div class="col-md-8 col-sm-12">
            <h3 class="titles">Bienvenue, <?php echo $nom; ?> !</h3>
            <form method="POST" action="" class="form">
              <div class="row">
                <div class="col-md-5">
                  <input type="hidden" name="id" id="id" value="<?php echo $id ?>">
                  <div class="form-group form-group-left">
                    <label for="nom">NOM<span class="required">  *</span></label>
                      <input id="nom" name="nom" class="form-control form-control-nom" placeholder="ex: Foulen" value="<?php echo $nom ?>" required>
                      <small class="form-text error-message error-message-nom">Le nom doit être sous la forme d'une chaîne de caractéres comprise entre 3 et 20 caractéres.</small>
                  </div>
                </div>
                <div class="col-md-5">
                   <div class="form-group form-group-right">
                    <label for="prenom">PRENOM<span class="required">  *</span></label>
                      <input id="prenom" name="prenom" class="form-control form-control-prenom" placeholder="ex: Foulen ou Ben Foulen" value="<?php echo $prenom ?>" required>
                      <small class="form-text error-message error-message-prenom">Le prénom doit être sous la forme d'une chaîne de caractéres comprise entre 3 et 20 caractéres</small>
                  </div>
                </div>
                <div class="col-md-2"></div>
              </div>

              <div class="row">
                <div class="col-md-5">
                  <div class="form-group form-group-left">
                    <label for="tel">NUMERO DE TELEPHONE<span class="required">  *</span></label>
                      <input id="tel" name="tel" class="form-control form-control-tel" placeholder="ex: 12345678" value="<?php echo $tel ?>" required>
                      <small class="form-text error-message error-message-tel">Le numéro de téléphone doit être composé de 8 chiffres</small>
                  </div>
                </div>
                <div class="col-md-5">
                   <div class="form-group form-group-right">
                    <label for="email">ADRESSE MAIL<span class="required">  *</span></label>
                      <input id="email" name="email" class="form-control form-control-email" placeholder="ex: foulen@domain.com" value="<?php echo $email ?>" required>
                      <small class="form-text error-message error-message-email">L'adresse mail doit être sous la forme d'une chaîne de caractéres comprise entre 10 et 30 caractéres</small>
                  </div>
                </div>
                <div class="col-md-2"></div>
              </div>


              <div class="row">
                <div class="col-md-5">
                  <div class="form-group form-group-left">
                    <label for="adresse">ADRESSE<span class="required">  *</span></label>
                      <input id="adresse" name="adresse" class="form-control form-control-adresse" placeholder="ex: Av. Hédi Nouira, Résidence Maya D1 Ennasr II" value="<?php echo $adresse; ?>" required>
                      <small class="form-text error-message error-message-adresse">L'adresse doit être une chaîne de caractéres comprise entre 10 et 30 caractéres</small>
                  </div>
                </div>
                <div class="col-md-5">
                   <div class="form-group form-group-right">
                    <label for="region">REGION<span class="required">  *</span></label>
                    <select name="region" class="form-control form-control-region" id="region" required>
                      <option value="" disabled="disabled" selected="selected"><?php echo $region ?></option>
                      <option value="Beja">Beja</option>
                      <option value="Bizerte">Bizerte</option>
                      <option value="Gabes">Gabes</option>
                      <option value="Gafsa">Gafsa</option>
                      <option value="Grand Tunis">Grand Tunis</option>
                      <option value="Jendouba">Jendouba</option>
                      <option value="Kairouan">Kairouan</option>
                      <option value="Kasserine">Kasserine</option>
                      <option value="Kebili">Kebili</option>
                      <option value="Le Kef">Le Kef</option>
                      <option value="Mahdia">Mahdia</option>
                      <option value="Medenine">Medenine</option>
                      <option value="Monastir">Monastir</option>
                      <option value="Nabeul">Nabeul</option>
                      <option value="Sfax">Sfax</option>
                      <option value="Sidi Bouzid">Sidi Bouzid</option>
                      <option value="Siliana">Siliana</option>
                      <option value="Sousse">Sousse</option>
                      <option value="Tataouine">Tataouine</option>
                      <option value="Tozeur">Tozeur</option>
                      <option value="Zaghouan">Zaghouan</option>
                    </select>
                      <small class="form-text error-message error-message-region">Veuillez séléctionner votre région</small>
                  </div>
                </div>
                <div class="col-md-2"></div>
              </div>

              <div class="row">
                <div class="col-md-5">
                  <div class="form-group form-group-left">
                    <label for="login">LOGIN<span class="required">  *</span></label>
                      <input id="login" name="login" class="form-control form-control-login" placeholder="ex: Foulen123" value="<?php echo $login; ?>" required>
                      <small class="form-text error-message error-message-login">Le login doit être une chaîne de caractéres comprise entre 5 et 20 caractéres</small>
                  </div>
                </div>
                <div class="col-md-5">
                   <div class="form-group form-group-right">
                    <label for="mdp">MOT DE PASSE<span class="required">  *</span></label>
                      <input type="password" id="mdp" name="mdp" class="form-control form-control-mdp" placeholder="Créer un mot de passe" value="<?php echo $mdp; ?>" required>
                      <small class="form-text error-message error-message-mdp-1">Le mot de passe est trop court</small>
                      <small class="form-text error-message error-message-mdp-2">Le mot de passe est trop long</small>
                  </div>
                </div>
                <div class="col-md-2"></div>
              </div>

              <div class="row">
			  
                <div class="col-md-4 col-sm-12">
                  <p class="red-text">* Champs obligatoires</p>
                </div>
                <div class="col-md-3"></div>
                <div class="col-md-5 col-sm-12 text-center">
                    <input type="submit" name="submit" id="save" value="Enregistrer">
                </div>
                
              </div>

              </form>
            </div>

          <div class="col-md-4 col-sm-12 text-center">
			<div class="settings">
				<div class="settings-bloc">
					<div class="settings-title">Gérer mon profil</div>
				</div>
				<div class="settings-options">
					<div class="set"><a href="profil/mesannonces.php">Mes annonces</a></div>
					<div class="set"><a href="deconnexion.php">Se déconnecter</a></div>
					<div class="set"><a href="#" data-toggle="modal" data-target="#myModel4">Désactiver mon compte</a></div>	
				</div>
					<div class="modal fade" id="myModel4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
						<div class="modal-dialog" role="document">
						  <div class="modal-content">
							<div class="modal-body">
							  <span>En désactivant votre compte, vous allez perdre toutes vos informations sur Sou9ni !</span>
								<div class="form-group text-center">
								<button type="button" class="btn btn-secondary" data-dismiss="modal">Annuler</button>
								  <button type="button" class="btn btn-primary"><a href="supprimer_compte.php">Désactiver</a></button>
								</div>
							</div>
						  </div>
						</div>
					  </div>
			</div>
            <a class="pub" href="#"><img class="img-fluid" src="images/pub3.jpg" alt="huile"></a>
          </div>
        </div>
      </div>
	  	<?php
		  if(isset($_POST["submit"])){
			include_once("verif_mail.php");
			if((!(ctype_alpha($_POST["nom"])))||(!(ctype_alpha($_POST["prenom"])))||(!(ctype_digit($_POST["tel"])))||((strlen($_POST["nom"]))>20)||((strlen($_POST["nom"]))<3)||((strlen($_POST["prenom"]))>20)||((strlen($_POST["prenom"]))<3)||((strlen($_POST["tel"]))!=8)||((strlen($_POST["email"]))>30)||((strlen($_POST["email"]))<10)||((strlen($_POST["adresse"]))>30)||((strlen($_POST["adresse"]))<10)||((strlen($_POST["mdp"]))<8)||((strlen($_POST["mdp"]))>30)||(verif($_POST["email"])==false)){
			echo"<div class='container'><h6 style='margin-top:1%;color:#fe2727;'>Echéc de modification !</h6></div>";
			}
			else{
				//connexion à la base de données
				$db = new mysqli("localhost", "root", "", "sou9nidb");
				
				$requete = "UPDATE utilisateur SET nom = '".$_POST['nom']."', prenom = '".$_POST['prenom']."', email = '".$_POST['email']."', adresse = '".$_POST['adresse']."', region = '".$_POST['region']."', tel = '".$_POST['tel']."', login = '".$_POST['login']."', mdp = '".$_POST['mdp']."' WHERE id =".$_POST["id"];
				$resultat = $db->query($requete);
					//print_r($requete);	
				$_SESSION["id"]=$_POST["id"];
				$_SESSION["nom"]=$_POST["nom"];
				$_SESSION["prenom"]=$_POST["prenom"];
				$_SESSION["email"]=$_POST["email"];
				$_SESSION["adresse"]=$_POST["adresse"];
				$_SESSION["tel"]=$_POST["tel"];
				$_SESSION["region"]=$_POST["region"];
				$_SESSION["login"]=$_POST["login"];
				$_SESSION["mdp"]=$_POST["mdp"];
				echo"<div class='container'><h6 style='margin-top:1%;color:green;'>Modification effectuée avec succés.</h6></div>";
			}
		}
		?>
   </section>
   
   <!-- Buy or sell a car-->
	<section class="about">
        <div class="row">
          <div class="col-md-6">
            <div class="about-left-image">
              <div class="wow slideInLeft" data-wow-delay="0s" data-wow-duration="1.3s">
                <h3 class="about-left-title">VOUS CHERCHEZ UNE VOITURE ?</h3>
                <p class="about-left-text">Cherchez votre voiture dans notre inventaire et n’hésitez pas à prendre un rendez-vous pour l’essayer.</p>
                <a class="explorer" href="#">Explorer</a><br/>
                <div></div>
              </div>
            </div>
          </div>

          <div class="col-md-6">
            <div class="about-right-image">
              <div class="wow slideInRight" data-wow-delay="0s" data-wow-duration="1.3s">
               <h3 class="about-right-title">VOUS VOULEZ VENDRE VOTRE VOITURE ?</h3>
               <p class="about-right-text">Créez un compte et déposez votre annonce et nous vous trouverons un acheteur le plus tôt possible.</p>
               <a class="vendre" href="#">Vendre</a><br/>
               <div></div>
             </div>
             </div>
            </div>
          </div>
	</section>
   
	<!-- Footer -->
      <?php
        include("footer.php");
      ?>

	<!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- wow JS -->
    <script src="js/wow.min.js"></script>

    <!-- Form-control-con Script JS -->
    <script src="js/form-control-con.js"></script>

    <!-- Form control Script JS -->
    <script src="js/form-control-compte.js"></script>

    <!-- Custom Script JS -->
    <script src="js/script.js"></script>
    </body>

</html>
